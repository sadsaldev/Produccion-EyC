-- CREACIÓN DE LA BASE DE DATOS LOCAL PARA PODER PRACTICAR CONSULTAS SQL

CREATE DATABASE BD_EJE_CAFETERO;
USE BD_EJE_CAFETERO;

CREATE TABLE Gestion_Humana_Cartas_Laborales (
 id INT AUTO_INCREMENT PRIMARY KEY,
 nombre varchar(45),
 cedula int(15),
 cargo varchar(45),
 salario int(15),
 fecha_ingreso date NOT NULL, 
 contrato varchar(35),
 fecha_retiro date, 
 observacion text,
 regional varchar(15),
 activo int(2)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

--INSERCIÓN DE LOS USUARIOS ORIGINALES
                                                                         --   YEAR, MONTH, DAY
INSERT INTO Gestion_Humana_Cartas_Laborales (id, nombre, cedula, cargo, salario, fecha_ingreso, contrato, fecha_retiro, observacion, regional, activo) VALUES 
('', 'ROJAS WILSON', '1096949994', 'AUXILIAR SST', '1700000', '2022-03-01', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'RAMIREZ WILSON ENRIQUE', '75097570', 'INSPECTOR', '1160000', '2019-11-21', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'PUERTA POTOSI BRILLID', '1088332058', 'SUPERNUMERARIA', '1250000', '2021-02-22', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'PATIÑO URIBE JOSE RAMIRO', '10281078', 'INSPECTOR', '1160000', '2020-07-06', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'PATIÑO CIFUENTES RICARDO', '10178572', 'INSPECTOR', '1160000', '2021-06-25', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'PIÑEROS RODRIGUEZ CESAR AUGUSTO', '18419532', 'INSPECTOR', '1160000', '2022-01-09', 'OBRA LABOR', '2023-06-22', '', 'PEREIRA', '1'),
('', 'OSPINA HENAO JORGE ANDRES', '75108179', 'INSPECTOR', '1160000', '2020-07-16', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'NARANJO MARIN JHON EDISON', '1053846711', 'INSPECTOR', '1160000', '2020-07-06', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'MONCADA GARCIA JONNY', '9873621', 'INSPECTOR', '1160000', '2020-07-06', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'MEJÍA DUQUE JORGE URIEL', '9971889', 'INSPECTOR', '1160000', '2022-10-18', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'MARTINEZ JARAMILLO CAMILO ANDRES', '1002632492', 'INSPECTOR', '1160000', '2022-09-01', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'MARIN TORRES JANIER STIVENS', '1088007355', 'GESTOR DE PROCESOS', '1600000', '2020-09-21', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'MARIN LEON JAISSON JOAQUIN', '1053842455', 'INSPECTOR', '1160000', '2020-07-06', 'OBRA LABOR', '', '', 'CALDAS', '0'),
('', 'LOPEZ VELEZ ESTEBAN', '1088330051', 'INSPECTOR', '1160000', '2020-11-18', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'LOPEZ PINEDA CESAR AUGUSTO', '4380311', 'INSPECTOR', '1160000', '2022-01-17', 'OBRA LABOR', '', '', 'PEREIRA', '0'),
('', 'LUISA FERNANDA SANCHEZ CASTRO ' ,'1030698547', 'DIGITADORA' , '1250000' , '2023-04-27' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'LOPEZ MARIN FELIX ANTONIO' ,'75088046', 'INSPECTOR' , '1160000' , '2020-07-06' , 'OBRA LABOR' , '2023-06-20' , '' , 'CALDAS' , '1'),
('', 'LUIS ANGEL CEBALLOS RENGIFO' ,'1059064874', 'INSPECTOR' , '1160000' , '2023-06-08' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'LOPEZ FLOREZ WILMAR AUGUSTO' ,'75078493', 'INSPECTOR' , '1160000' , '2022-01-17' , 'OBRA LABOR' , '2023-08-02' , '' , 'CALDAS' , '1'),
('', 'LOAIZA LOPEZ LEONARDO' ,'15962694', 'SUPERVISOR' , '1900000' , '2020-07-06' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'LERMA ASPRILLA JESUS ANTONIO' ,'94229979', 'INSPECTOR' , '1160000' , '2022-07-07' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'LEON MARIN LEONARDO FABIO' ,'10007322', 'INSPECTOR' , '1160000' , '2020-07-16' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'LARGO OSORIO JOSE OMAR' ,'75082678', 'INSPECTOR' , '1160000' , '2020-07-06' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'JIMENEZ SANCHEZ JAVIER MAURICIO' ,'75091571', 'DIRECTOR DE PROYECTO' , '5100000' , '2019-10-18' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'JORGE ANDRES OCAMPO ARIAS' ,'1053853388', 'INSPECTOR' , '1160000' , '2023-06-08' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'JONIER LONDOÑO OSPINA' ,'1010142099', 'INSPECTOR' , '1160000' , '2023-06-08' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'GARZON ESPINOSA ALFREDO' ,'94287666', 'INSPECTOR' , '1160000' , '2019-11-22' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'GARCIA GRISALES CESAR AUGUSTO' ,'1053832636', 'INSPECTOR' , '1160000' , '2023-01-27' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'GALVEZ HENAO YEISON JAVIER' ,'75104408', 'PROGRAMADOR' , '1600000' , '2022-01-08' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'GALEANO GRISALEZ RICARDO' ,'1088316916', 'INSPECTOR' , '1160000' , '2019-12-20' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'CRISTIAN DAVID DUQUE ' ,'1053867433', 'INSPECTOR' , '1160000' , '2023-06-08' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'COBO HOYOS JUAN MANUEL' ,'10276802', 'INSPECTOR' , '1160000' , '2020-07-06' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'CARDONA CANO NELSON' ,'1053816953', 'INSPECTOR' , '1160000' , '2019-12-20' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'CARDENAS GUTIERREZ LILIANA' ,'1024516239', 'DIGITADORA' , '1250000' , '2022-07-18' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'CALERO RAMIREZ JOSE ALEXANDER' ,'1114062435', 'SUPERVISOR' , '1900000' , '2021-08-20' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'CAICEDO ESCOBAR JUNIOR SANTIAGO' ,'1093219129', 'INSPECTOR' , '1160000' , '2020-07-16' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'BUITRAGO RAMIREZ LEONAR ORLANDO' ,'75094997', 'INSPECTOR' , '1160000' , '2021-01-04' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'BORJAS WILLY ALEXANDER' ,'75103624', 'INSPECTOR' , '1160000' , '2020-07-06' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'BERLAYNE TORO TORO' ,'1117524757', 'INSPECTOR' , '1160000' , '2022-01-17' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'BEDOYA SANCHEZ CRISTIAN DAVID' ,'1060648864', 'INSPECTOR' , '1160000' , '2020-07-06' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'BEDOYA ARENAS DIEGO ALEJANDRO' ,'1004734681', 'INSPECTOR' , '1160000' , '2022-01-17' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'ARROYAVE GALLEGO ANDRES FERNANDO' ,'1058820644', 'INSPECTOR' , '1160000' , '2020-07-06' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'ARREDONDO SANCHEZ BRAYAN ESTIBEN' ,'1053850955', 'INSPECTOR' , '1160000' , '2022-01-18' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'ARIAS TORO YEISON' ,'1114787169', 'INSPECTOR' , '1160000' , '2020-07-16' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'AREVALO ARIAS JENNY TATIANA' ,'1088258795', 'AUXILIAR ADMINISTRATIVA' , '1500000' , '2021-02-20' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'ARDILA MORA GUSTAVO ADOLFO' ,'1082876221', 'INSPECTOR' , '1160000' , '2022-01-17' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'AMAYA HINCAPIE JUAN CARLOS' ,'15962689', 'INSPECTOR' , '1160000' , '2020-07-07' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'CARDONA MONTOYA YESID' ,'1054564031', 'INSPECTOR' , '1160000' , '2020-08-01' , 'OBRA O LABOR' , '2023-05-16' , '' , 'PEREIRA' , '1'),
('', 'TABA OSORNO CLAUDIA LILIANA' ,'42121395', 'DIGITADORA' , '1450000' , '2019-11-19' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0'),
('', 'TORRES HERNANDEZ JOHN JAMES' ,'16075123', 'INSPECTOR' , '1160000' , '2021-01-04' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'VARGAS ALZATE LUZ AMPARO' ,'1059812577', 'AUXILIAR ARCHIVO' , '1250000' , '2022-08-10' , 'OBRA LABOR' , '' , '' , 'CALDAS' , '0'),
('', 'MENDEZ DIAZ DANIEL ALBERTO' ,'93394197', 'INSPECTOR' , '1160000' , '2022-12-28' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , '0');

-- CREACIÓM DE LA COLUMNA "ESTADO" QUE INCLUYE LOS DATOS "ACTIVO" E "INACTIVO" 

ALTER TABLE gestion_humana_cartas_laborales ADD COLUMN estado varchar(15);
UPDATE gestion_humana_cartas_laborales SET estado = activo;
UPDATE gestion_humana_cartas_laborales SET estado = "ACTIVO" WHERE activo = 0;
UPDATE gestion_humana_cartas_laborales SET estado = "INACTIVO" WHERE activo = 1;
ALTER TABLE gestion_humana_cartas_laborales DROP COLUMN activo; --ELIMINACIÓN DE LA COLUMNA ORIGINAL DENOMINADA "ACTIVO" QUE CONTENÍA DATOS BINARIOS

-- ACTUALIZACIÓN DE LOS DATOS DE LOS USUARIOS QUE YA ESTABAN EN LA BASE

--1. ACTUALIZACIÓN DE SALARIO DE 1.160.000 A 1.300.000 (S.M.L.V 2024)

UPDATE gestion_humana_cartas_laborales SET salario=1300000 WHERE cedula IN ('15962689','1082876221','1114787169','1053850955','1058820644',
'1004734681','1060648864','1117524757','75103624','75094997','1093219129','1024516239','1053816953','10276802','1088316916','1053832636',
'94287666','1053853388','75082678','10007322','94229979','4380311','1088330051','1053842455','9971889','93394197','9873621','1053846711',
'75108179','1088332058','75097570','16075123','1059812577', '10178572');


-- 2. ACTUALIZACIONES ESPECÍFICAS PARA DETERMINADOS USUARIOS
UPDATE gestion_humana_cartas_laborales SET regional = 'CALDAS' WHERE cedula='1054564031';
UPDATE gestion_humana_cartas_laborales SET cargo='RESIDENTE' WHERE cedula='1088007355';
UPDATE gestion_humana_cartas_laborales SET cargo='AUXILIAR PQR' WHERE cedula='1053846711';
UPDATE gestion_humana_cartas_laborales SET cargo='DIGITADORA' WHERE cedula='1088332058';
UPDATE gestion_humana_cartas_laborales SET cargo='COORDINADORA REDES NUEVAS' WHERE cedula IN ('1024516239','1059812577');

-- 3. ACTUALIZACIÓN MASIVA PARA CAMBIAR FECHA DE RETIRO Y ESTADO INACTIVO A USUARIOS QUE SE HAN RETIRADO HASTA LA FECHA

UPDATE gestion_humana_cartas_laborales
SET 
 fecha_retiro = CASE 
                    WHEN cedula = '1053867433' THEN '2023-07-08'
                    WHEN cedula = '1010142099' THEN '2023-07-07'
                    WHEN cedula = '1059064874' THEN '2023-10-28'
                    WHEN cedula = '1030698547' THEN '2023-10-05'
                    WHEN cedula = '1002632492' THEN '2023-07-26'
                    WHEN cedula = '10281078'   THEN '2023-10-28'
                END,
 estado = 'INACTIVO' WHERE cedula IN ('1053867433','1010142099','1059064874','1030698547','1002632492','10281078');

 -- INSERTAR USUARIOS NUEVOS HASTA LA FECHA

INSERT INTO Gestion_Humana_Cartas_Laborales (id, nombre, cedula, cargo, salario, fecha_ingreso, contrato, fecha_retiro, observacion, regional, estado) VALUES 
('', 'ARARAT CAICEDO HEBERT ARMANDO' ,'16893721', 'INSPECTOR' , '1160000' , '2023-5-29' , 'OBRA LABOR' , '2023-9-15' , '' , 'PEREIRA' , 'INACTIVO'),
('', 'ARIAS FLOREZ JULIO MAURICIO ' ,'16917543', 'INSPECTOR' , '1160000' , '2023-10-06' , 'OBRA LABOR' , '2023-11-30' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'BEDOYA MUÑOZ JOAN DAVID' ,'1088824952', 'PRACTICANTE SENA' , '487500' , '2023-10-17' , 'CONTRATO DE APRENDIZAJE' , '' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'BORREGO PINTO VANESSA CAROLINA' ,'1201260636', 'PRACTICANTE SENA' , '487500' , '2023-10-17' , 'CONTRATO DE APRENDIZAJE' , '' , '' , 'PEREIRA' , 'ACTIVO'),
('', 'CARDOZA FERNANDEZ HENSLY FERNANDO' ,'6240005', 'INSPECTOR' , '1160000' , '2021-04-05' , 'OBRA LABOR' , '2023-06-03' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'CARVAJAL RESTREPO JUAN DAVID' ,'1088307806', 'INSPECTOR' , '1300000' , '2023-07-27' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'CIFUENTES RODRIGUEZ FABIO ANDRES' ,'11232830', 'INSPECTOR' , '1160000' , '2022-12-22' , 'OBRA LABOR' , '2023-03-16' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'CORTES DIAZ JUAN PABLO' ,'16074663', 'INSPECTOR' , '1160000' , '2022-12-28' , 'OBRA LABOR' , '2023-04-30' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'GAVIRIA CANO FABIO NELSON' ,'1088237995', 'INSPECTOR' , '1160000' , '2023-5-29' , 'OBRA LABOR' , '2023-9-15' , '' , 'CALDAS' , 'INACTIVO'),	
('', 'GIRALDO CARMONA LUISA FERNANDA' ,'1088327094', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'GIRALDO MONTES YULIANA MARCELA' ,'1053858027', 'AUXILIAR PROGRAMACION' , '1160000' , '2020-11-11' , 'OBRA LABOR' , '2023-01-14' , '' , 'CALDAS' , 'INACTIVO'),	
('', 'LONDOÑO GIRALDO JUAN MIGUEL' ,'1053857418', 'INSPECTOR' , '1300000' , '2023-07-17' , 'OBRA LABOR' , '' , '' , 'CALDAS' , 'ACTIVO'),	
('', 'LONDOÑO MESA SALOME' ,'1085718104', 'PRACTICANTE SENA' , '487500' , '2023-10-17' , 'CONTRATO DE APRENDIZAJE' , '' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'MARIN GRANADA ALEXANDER' ,'1060649962', 'INSPECTOR' , '1160000' , '2023-08-08' , 'OBRA LABOR' , '2023-12-04' , '' , 'CALDAS' , 'INACTIVO'),	
('', 'MARIN RODRIGUEZ ALVARO' ,'79550445', 'INSPECTOR' , '1300000' , '2023-10-07' , 'OBRA LABOR' , '2024-01-13' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'MAYA ALVAREZ NELSON ADRIAN' ,'1088292008', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '2023-9-15' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'OCAMPO TORRES NESTOR FERNANDO' ,'9735616', 'INSPECTOR' , '1160000' , '2023-08-30' , 'OBRA LABOR' , '2023-11-24' , '' , 'CALDAS' , 'INACTIVO'),
('', 'OLIVERA GUAPACHA JOSE ARLES' ,'1059712042', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '' , '' , 'CALDAS' , 'ACTIVO'),	
('', 'OSORIO BUITRAGO SERGIO ALEXANDER' ,'1004801134', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'OSPINA RODRIGUEZ  DANIEL ALBERTO' ,'1053795763', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '' , '' , 'CALDAS' , 'ACTIVO'),	
('', 'PERDOMO OTAVO MILTON DANIEL' ,'9771490', 'INSPECTOR' , '1300000' , '2024-01-04' , 'OBRA LABOR' , '' , '' , 'CALDAS' , 'ACTIVO'),
('', 'PLACERES MARVAL RAUL JOSE' ,'1420771', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '2023-9-15' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'RAMIREZ HURTADO HECTOR FABIO' ,'1060586173', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '' , '' , 'CALDAS' , 'ACTIVO'),	
('', 'RODRIGUEZ POSADA JUAN PABLO' ,'1004520303', 'PRACTICANTE SENA' , '487500' , '2023-10-17' , 'CONTRATO DE APRENDIZAJE' , '' , '' , 'PEREIRA' , 'ACTIVO'),	
('', 'SALAZAR RAMIREZ YONATAN' ,'1088238697', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '2023-01-27' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'SANCHEZ LAGUNA JUAN DIEGO' ,'10184040', 'PRACTICANTE SENA' , '487500' , '2023-10-17' , 'CONTRATO DE APRENDIZAJE' , '' , '' , 'CALDAS' , 'ACTIVO'),	
('', 'SERNA DURANGO MARIA CAMILA' ,'1225092397', 'COORDINADORA DE PROCESOS' , '1600000' , '2023-09-11' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , 'ACTIVO'),
('', 'VARGAS FRANCO JOHN EDISON' ,'16077085', 'INSPECTOR' , '1300000' , '2023-12-14' , 'OBRA LABOR' , '' , '' , 'CALDAS' , 'ACTIVO'),
('', 'VARGAS HERNANDEZ ANA CRISTINA' ,'1053859954', 'DIGITADORA' , '1160000' , '2019-11-12' , 'OBRA LABOR' , '2023-04-20' , '' , 'CALDAS' , 'INACTIVO'),
('', 'VILLADA GIRALDO WILDER HERNÁN' ,'1087984824', 'INSPECTOR' , '1160000' , '2023-06-14' , 'OBRA LABOR' , '2023-06-22' , '' , 'PEREIRA' , 'INACTIVO'),	
('', 'VILLADA ORTIZ YAMILETH' ,'1089721559', 'AUXILIAR ARCHIVO' , '1300000' , '2023-09-04' , 'OBRA LABOR' , '' , '' , 'PEREIRA' , 'ACTIVO'),
('', 'VIRACACHA RESTREPO CARLOS ANDRÉS' ,'94505792', 'INSPECTOR' , '1160000' , '2022-02-04' , 'OBRA LABOR' , '2023-06-07' , '' , 'PEREIRA' , 'INACTIVO'),
('', 'ZAPATA RESTREPO ANDRES DAVID' ,'1121148295', 'INSPECTOR' , '1300000' , '2023-12-26' , 'OBRA LABOR' , '2023-12-30' , '' , 'PEREIRA' , 'INACTIVO');

-- VACIAR FECHAS DE RETIRO QUE SE MUESTRAN COMO "0000-00-00" PARA LOS USUARIOS QUE SIGUEN ACTIVOS
UPDATE gestion_humana_cartas_laborales SET fecha_retiro = null WHERE estado = 'ACTIVO';


--CREACIÓN DE COLUMNA "ACTIVO" QUE CONTENDRÁ DATOS BOOLEANOS
ALTER TABLE gestion_humana_cartas_laborales ADD COLUMN activo BOOLEAN NOT NULL;

-- INGRESAR VALORES BOOLEANOS CORRESPONDIENTE AL ESTADO DE USUARIO
UPDATE gestion_humana_cartas_laborales SET activo=1 WHERE estado = 'ACTIVO';
UPDATE gestion_humana_cartas_laborales SET activo=0 WHERE estado = 'INACTIVO';

--CREAR USUARIO ROOT
CREATE USER 'rooteje'@'localhost' IDENTIFIED BY '12345';
GRANT ALL PRIVILEGES ON rooteje.* TO 'rooteje'@'localhost';
FLUSH PRIVILEGES;


-------------------------------------------------------------------------------------------------------------

CREATE TABLE inspectores (
 NombreOperario VARCHAR (45),
 NroOperario INT(20) PRIMARY KEY,
 Estado varchar(15)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

INSERT INTO inspectores (NombreOperario, NroOperario, Estado) 
VALUES
--Inspectores Risaralda
('ARARAT CAICEDO HEBERT ARMAND', '16893721', 'INACTIVO'),
('ARDILA MORA GUSTAVO ADOLFO', '1082876221', 'ACTIVO'),
('ARIAS FLOREZ JULIO MAURICIO ', '16917543', 'INACTIVO'),
('ARIAS TORO YEISON', '1114787169', 'ACTIVO'),
('Bedoya Diego Alejandro', '1004734681', 'ACTIVO'),
('CAICEDO ESCOBAR JUNIOR SANTIAGO', '1093219129', 'ACTIVO'),
('CARDOZA FERNANDEZ HENSLY FERNANDO', '6240005', 'INACTIVO'),
('CARVAJAL RESTREPO JUAN DAVID', '1088307806', 'ACTIVO'),
('CEBALLOS RENGIFO LUIS ANGEL', '1059064874', 'INACTIVO'),
('CIFUENTES RODRIGUEZ FABIO ANDRES', '11232830', 'INACTIVO'),
('CORTES DIAZ JUAN PABLO', '16074663', 'INACTIVO'),
('GALEANO GRISALEZ RICARDO', '1088316916', 'ACTIVO'),
('GARZON ESPINOSA ALFREDO', '94287666', 'ACTIVO'),
('GIRALDO CARMONA LUISA FERNANDA', '1088327094', 'ACTIVO'),
('LEON MARIN LEONARDO FABIO', '10007322', 'ACTIVO'),
('LERMA ASPRILLA JESUS ANTONIO', '94229979', 'ACTIVO'),
('LOPEZ PINEDA CESAR AUGUSTO', '4380311', 'ACTIVO'),
('LOPEZ VELEZ ESTEBAN', '1088330051', 'ACTIVO'),
('MARIN RODRIGUEZ ALVARO', '79550445', 'INACTIVO'),
('MAYA ALVAREZ NELSON ADRIAN', '1088292008', 'ACTIVO'),
('MENDEZ DIAZ DANIEL ALBERTO', '93394197', 'ACTIVO'),
('MONCADA GARCIA JONNY', '9873621', 'ACTIVO'),
('OSORIO BUITRAGO SERGIO ALEXANDER', '1004801134', 'ACTIVO'),
('PATIÑO CIFUENTES RICARDO', '10178572', 'ACTIVO'),
('PIÑEROS RODRIGUEZ CESAR AUGUSTO', '18419532', 'INACTIVO'),
('MARVAL PLACERES RAUL JOSE', '1420771', 'ACTIVO'),
('SALAZAR RAMIREZ YONATAN', '1088238697', 'INACTIVO'),
('TORO TORO BERLAYNE', '1117524757', 'ACTIVO'),
('VILLADA GIRALDO WILDER HERNÁN', '1087984824', 'INACTIVO'),
('VIRACACHA RESTREPO CARLOS ANDRES', '94505792', 'INACTIVO'),
('ZAPATA RESTREPO ANDRES DAVID', '1121148295', 'INACTIVO'),
--Inspectores Caldas
('AMAYA HINCAPIE JUAN CARLOS', '15962689', 'ACTIVO'),
('ARREDONDO SANCHEZ BRAYAN ESTIBEN', '1053850955', 'ACTIVO'),
('ARROYAVE GALLEGO ANDRES FERNAN', '1058820644', 'ACTIVO'),
('BEDOYA SANCHEZ CRISTIAN DAVID', '1060648864', 'ACTIVO'),
('BORJAS WILLY ALExANDER', '75103624', 'ACTIVO'),
('BUITRAGO RAMIREZ LEONARD', '75094997', 'ACTIVO'),
('CARDONA CANO NELSON', '1053816953', 'ACTIVO'),
('CARDONA MONTOYA YESID', '1054564031', 'INACTIVO'),
('COBO HOYOS JUAN MANUEL', '10276802', 'ACTIVO'),
('DUQUE BLANDON CRISTIAN DAVID', '1053867433', 'INACTIVO'),
('GARCIA GRISALES CESAR AUGUSTO', '1053832636', 'ACTIVO'),
('GAVIRIA CANO FABIO NELSON', '1088237995', 'INACTIVOS'),
('LARGO OSORIO JOSE OMAR', '75082678', 'ACTIVO'),
('Juan Miguel londoño Giraldo', '1053857418', 'ACTIVO'),
('JONIER LONDOÃ?O OSPINA', '1010142099', 'INACTIVO'),
('LOPEZ FLOREZ WILMAR AUGUSTO', '75078493', 'INACTIVO'),
('LOPEZ MARIN FELIX ANTONIO', '75088046', 'INACTIVO'),
('MARIN GRANADA ALEXANDER', '1060649962', 'INACTIVO'),
('MARIN LEON JAISSON JOAQUIN', '1053842455', 'ACTIVO'),
('MARTINEZ JARAMILLO CAMILO ANDRES', '1002632492', 'INACTIVO'),
('MEJIA DUQUE JORGE URIEL', '9971889', 'ACTIVO'),
('OCAMPO ARIAS JORGE ANDRES', '1053853388', 'ACTIVO'),
('OCAMPO TORRES NESTOR FERNANDO', '9735616', 'INACTIVO'),
('ARLES OLIVIERA JOSE', '1059712042', 'ACTIVO'),
('OSPINA HENAO JORGE ANDRES', '75108179', 'ACTIVO'),
('OSPINA RODRIGUEZ  DANIEL ALBERTO', '1053795763', 'ACTIVO'),
('PATINO URIBE JOSE RAMIRO', '10281078', 'INACTIVO'),
('PERDOMO OTAVO MILTON DANIEL', '9771490', 'ACTIVO'),
('RAMIREZ HURTADO HECTOR FABIO', '1060586173', 'ACTIVO'),
('RAMIREZ WILSON ENRIQUE', '75097570', 'ACTIVO'),
('TORRES HERNANDEZ JOHN JAMES', '16075123', 'ACTIVO'),
('VARGAS FRANCO JOHN EDISON', '16077085', 'ACTIVO');


CREATE TABLE cortes_risaralda (
 id_corte INT AUTO_INCREMENT PRIMARY KEY,
 rango_corte1 DATE NOT NULL, 
 rango_corte2 DATE NOT NULL, 
 NombreOperario VARCHAR (45), 
 NroOperario INT(20),
 NroSitio VARCHAR(20), 
 Depto VARCHAR(15), 
 Direccion TEXT, 
 FechaRealInicio DATE NOT NULL,
 FechaRealFin DATE NOT NULL, 
 TipoTarea VARCHAR (40), 
 Prioridad VARCHAR (40),
 FechaVisita DATE NOT NULL,
 Cierre3 VARCHAR (30), 
 Duracion VARCHAR(20),
 --FOREIGN KEY (NroOperario) REFERENCES inspectores(NroOperario)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE cortes_caldas (
 id_corte INT AUTO_INCREMENT PRIMARY KEY,
 rango_corte1 DATE NOT NULL, 
 rango_corte2 DATE NOT NULL, 
 NombreOperario VARCHAR (45), 
 NroOperario INT(20), 
 NroSitio VARCHAR(20), 
 Depto VARCHAR(15), 
 Direccion TEXT, 
 FechaRealInicio DATE NOT NULL,
 FechaRealFin DATE NOT NULL, 
 TipoTarea VARCHAR (40), 
 Prioridad VARCHAR (40),
 FechaVisita DATE NOT NULL,
 Cierre3 VARCHAR (30), 
 Duracion VARCHAR(20),
 --FOREIGN KEY (NroOperario) REFERENCES inspectores(NroOperario)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE last_inspection_timestamps (
    id INT AUTO_INCREMENT PRIMARY KEY,
    departamento VARCHAR(25),
    fecha_inicio DATE,
    fecha_final DATE,
    last_timestamp DATETIME
);

--CONSULTA PARA OBTENER LA CANTIDAD DE INSPECCIONES HECHAS POR INSPECTOR EN UN RANGO DE FECHA DE CORTE ESPECIFICA

SELECT i.NombreOperario, COUNT(*) AS CantidadInspecciones
FROM inspectores i 
JOIN cortes_caldas c ON i.NroOperario = c.NroOperario
WHERE c.rango_corte1 = '2024-01-08' AND  c.rango_corte2 = '2024-01-09'
GROUP BY i.NombreOperario;

SELECT i.NombreOperario, COUNT(*) AS CantidadInspecciones
FROM inspectores i 
JOIN cortes_risaralda c ON i.NroOperario = c.NroOperario
WHERE c.rango_corte1 = '2024-01-08' AND  c.rango_corte2 = '2024-01-09'
GROUP BY i.NombreOperario;

SELECT NombreOperario, SUM(CantidadInspecciones) AS TotalInspecciones
FROM (
    SELECT i.NombreOperario, COUNT(*) AS CantidadInspecciones
    FROM inspectores i 
    JOIN cortes_caldas c ON i.NroOperario = c.NroOperario
    WHERE c.rango_corte1 = '2024-01-08' AND  c.rango_corte2 = '2024-01-09'
    GROUP BY i.NombreOperario
    
    UNION ALL
    
    SELECT i.NombreOperario, COUNT(*) AS CantidadInspecciones
    FROM inspectores i 
    JOIN cortes_risaralda c ON i.NroOperario = c.NroOperario
    WHERE c.rango_corte1 = '2024-01-08' AND  c.rango_corte2 = '2024-01-09'
    GROUP BY i.NombreOperario
) AS TotalPorInspectores
GROUP BY NombreOperario;

ALTER TABLE cortes_risaralda ADD CONSTRAINT fk_inspector FOREIGN KEY (NroOperario) REFERENCES inspectores_risaralda(NroOperario);